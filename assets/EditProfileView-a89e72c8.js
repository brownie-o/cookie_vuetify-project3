import{_ as O,b as R,l as $,r as b,u as v,c as w,o as y,e as q,i as e,w as l,h as t,J as B,F as H,s as K,f as G,V as m,d4 as E,I as p,H as _,L as x,q as d,bs as c,K as P,g as D}from"./index-eeb36eca.js";import{_ as U}from"./favicon-5ff3d8e0.js";import{u as z,b as I}from"./index.esm-1c39363a.js";import{V as J}from"./VForm-0b5bd14b.js";import{a as i,V as o}from"./VRow-30f61178.js";import"./_commonjsHelpers-de833af9.js";const Q={__name:"EditProfileView",setup(W){const a=R(),h=$(),{apiAuth:S}=K();b(null);const{xs:g}=v(),{md:L}=v(),{lg:M}=v(),k=w(()=>g.value),A=w(()=>L.value),N=w(()=>M.value),{isSubmitting:r,handleSubmit:T,resetForm:X}=z();I("name"),I("finalGoal");const C=b([]);b([]);const F=()=>{if(g.value)return"center";if(!g.value)return"bottom"},j=T(async V=>{var n,s;try{console.log("submit");const u=new FormData;for(const f in V)u.append(f,V[f]);C.value.length>0&&u.append("image",C.value[0].file),console.log(u),console.log("values",a.name),await S.patch(`/users/${a._id}`,{name:a.name,finalGoal:a.finalGoal}),await S.patch(`/users/${a._id}`,u),h({text:"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:F(),rounded:"pill",variant:"tonal"}}),a.getProfile()}catch(u){console.log(u);const f=((s=(n=u==null?void 0:u.response)==null?void 0:n.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";h({text:f,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:F(),rounded:"pill",variant:"tonal"}})}});return(V,n)=>(y(),q(H,null,[e(J,{disabled:t(r),onSubmit:B(t(j),["prevent"])},{default:l(()=>[!k.value&&(A.value||N.value)?(y(),G(P,{key:0,class:"mx-auto mt-50 p-2","max-width":1e3},{default:l(()=>[e(i,null,{default:l(()=>[e(m,{class:"ms-3 mt-3",icon:"mdi-arrow-left",to:"/profile",variant:"text"})]),_:1}),e(i,{class:"justify-center mb-3"},{default:l(()=>[e(E,{class:"title"},{default:l(()=>[p("編輯個人資料")]),_:1})]),_:1}),e(i,{class:"mt-0",justify:"center"},{default:l(()=>[e(o,{cols:"3"},{default:l(()=>[e(_,{class:"w-50 mx-auto",src:t(a).avatar},null,8,["src"])]),_:1}),e(o,{class:"d-flex align-center",cols:"3"},{default:l(()=>[e(x,{modelValue:t(a).name,"onUpdate:modelValue":n[0]||(n[0]=s=>t(a).name=s),label:"編輯名稱",variant:"outlined",rules:[s=>!!s||"必填"]},null,8,["modelValue","rules"])]),_:1}),e(o,{class:"color d-flex align-center",cols:"3"},{default:l(()=>[d("h4",null,"好友代碼: "+c(t(a).friendsCode),1)]),_:1}),e(o,{class:"color d-flex align-center",cols:"3"},{default:l(()=>[e(_,{class:"flex-0",src:U,width:"30",height:"30"}),d("h4",null," : "+c(t(a).cookieNum),1)]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(o,{class:"d-flex align-center",cols:"6"},{default:l(()=>[d("span",null,"餅乾計畫初始日: "+c(t(a)&&t(a).createdAt?new Date(t(a).createdAt).toJSON().slice(0,10).split("-").join("/"):"N/A"),1)]),_:1}),e(o,{class:"d-flex align-center",cols:"6"},{default:l(()=>[d("span",null,"達成天數: "+c(t(a).accomplishment),1)]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(o,{class:"d-flex align-center",cols:"12"},{default:l(()=>[e(x,{modelValue:t(a).finalGoal,"onUpdate:modelValue":n[1]||(n[1]=s=>t(a).finalGoal=s),label:"最終目標",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{class:"btnStyle mx-auto d-flex my-5","prepend-icon":"mdi-content-save-edit-outline",type:"submit",loading:t(r)},{default:l(()=>[p("SAVE")]),_:1},8,["loading"])]),_:1})):D("",!0)]),_:1},8,["disabled","onSubmit"]),e(J,{disabled:t(r),onSubmit:B(t(j),["prevent"])},{default:l(()=>[!A.value&&!N.value?(y(),G(P,{key:0,class:"mx-auto mt-50 p-2","max-width":k.value?"480":"600"},{default:l(()=>[e(i,null,{default:l(()=>[e(m,{class:"ms-3 mt-3",icon:"mdi-arrow-left",to:"/profile",variant:"text"})]),_:1}),e(i,{class:"justify-center mb-3"},{default:l(()=>[e(E,{class:"title"},{default:l(()=>[p("編輯個人資料")]),_:1})]),_:1}),e(i,{class:"mt-0",justify:"center"},{default:l(()=>[e(o,{cols:"6"},{default:l(()=>[e(_,{class:"w-50 mx-auto",src:t(a).avatar},null,8,["src"])]),_:1}),e(o,{class:"d-flex align-center",cols:"6"},{default:l(()=>[e(x,{modelValue:t(a).name,"onUpdate:modelValue":n[2]||(n[2]=s=>t(a).name=s),label:"編輯名字",variant:"outlined",rules:[s=>!!s||"必填"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(i,{class:"mt-0",justify:"center"},{default:l(()=>[e(o,{class:"color d-flex align-center",cols:"6"},{default:l(()=>[d("h4",null,"好友代碼: "+c(t(a).friendsCode),1)]),_:1}),e(o,{class:"color d-flex align-center",cols:"6"},{default:l(()=>[e(_,{class:"flex-0",src:U,width:"30",height:"30"}),d("h4",null," : "+c(t(a).cookieNum),1)]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(o,{class:"d-flex align-center",cols:"6"},{default:l(()=>[d("span",null,"餅乾計畫初始日: "+c(t(a)&&t(a).createdAt?new Date(t(a).createdAt).toJSON().slice(0,10).split("-").join("/"):"N/A"),1)]),_:1}),e(o,{class:"d-flex align-center",cols:"6"},{default:l(()=>[d("span",null,"達成天數: "+c(t(a).accomplishment),1)]),_:1})]),_:1}),e(i,null,{default:l(()=>[e(o,{class:"d-flex align-center",cols:"12"},{default:l(()=>[e(x,{modelValue:t(a).finalGoal,"onUpdate:modelValue":n[3]||(n[3]=s=>t(a).finalGoal=s),label:"最終目標",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{class:"btnStyle mx-auto d-flex my-5","prepend-icon":"mdi-content-save-edit-outline",type:"submit",loading:t(r)},{default:l(()=>[p("SAVE")]),_:1},8,["loading"])]),_:1},8,["max-width"])):D("",!0)]),_:1},8,["disabled","onSubmit"])],64))}},se=O(Q,[["__scopeId","data-v-d9a3c134"]]);export{se as default};
